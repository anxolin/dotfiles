sudo: required

services:
  - docker
env:
  matrix:
    - DOCKER_REPO_SLUG=anxolin/dotfiles-alpine DOCKER_FILE=Dockerfile-alpine
    - DOCKER_REPO_SLUG=anxolin/dotfiles-arch DOCKER_FILE=Dockerfile-arch
    - DOCKER_REPO_SLUG=anxolin/dotfiles-ubuntu DOCKER_FILE=Dockerfile-ubuntu
  global:
    - secure: KngpVJH2TVU/pq6Jq+gBR8htzmGU9693nbnpB7n4izqp5AJPxEaE/FyXy3+wfzyGqS6/uioDpfs94vxwFjqIFN+if59BuZHfBdvWPQFwAQi+cx+xx5zEJuO5QrfgilxK+j0ldwdCcgCZR43RLTwm3R3Un3rloCA8+pB81rH8lr6kfD5Zanbyl61uMpDke0WC9puBipTMZ7IAtVkVv0W/JkQ5YH41wGmmyJr3ZNQ27vlxFBRWFPpwplEEQqNfnJCwvO3tyXKq/5JWXk8TmGO7UcOtQ4zOTAQI0ubw3+WmwyArc7LQ89aSRHOwtM9Z1BBuB5PEpj+it/iP8Wnkc65e226dFR1q9gj/Z+tJ/+ssnKgYHO/qJ5Y3HO2m9LaGGf+PhJPh4DPeRlrmQbsZLYJgBwyWNoLcxvmYl+JadzNW9dD3oDnBWpxsH0RdjEHS0twT/D852qaAAkzgOP8Cj1GVb9Q0b3U4Ao12HC6/HsdSd3AkvOCI0fnDAetx3NeLZ71Looo0n0pCQ+FoMA6VsOMjS8MKiRaDkgO27eKFAJChFWsqpz0MtSBwfGxYIzWTT1jy5C0bmXAs8G2MMTc65WR0wpoLzk+qVjMxtAFmG4DsUyTEWeRYZNZtOB++GHQ/UCZ4dVO5dsIMPq0q+5WhQEpZrpBwrFCx6MBFQEftA8fZF/g=
    - secure: T++tckc2VmMo/RJ6fUMrfJ+yMjgE0bQYBcoGLsElKLCfDvO28KAnN6XaqA23qknAAfWSf6Ym/DciLhVltCdugiPt9kYoGIiomVmzkT1jhvPzN1Jmhd58ZTo4cuNqAZKisGyL6xMiwxlFzORnV/A0batNHOJt90755e9H14t+/Sa6rVaTI85l5HlBKX+Ers1vHPI9wJ9WN6XL6KmlF+qUwJteieX7I3+X6wmwRxkM4bk+gVOsNr+abAmkyf2KexxhxXEcYJ/ouGwphWZnIa2swZuxR6YInr5mqbmTbqLq3Gckw7G6m+lbyUzIMgs6WOFUJbYhf1oXcC+wq9lFarflFbHW67Ujmoi2lPy9TN6odM9c8dYPoR+3Q2xVK8Pov1DdvNzChgigQaPWpd/VOKfIgJ/V7RUYSY6i0SENKByEDZ+oTTBr6gyOuxYODfBnhM2OY+OznUIg1RTuSVqU1WCNTmPrds262WXHvDwVH1/QxcG0TGm4n6kZeUCtHJ2N3QdRCOF3EtaOCaAs0FZ+6zOFhC5SHfrhhLs/K09xuSZGg/DojGhkkul+77B6o88QnnBkm6nA1+py7of7K13Gp0wX0SOZbW9ZSkG8kNVvHNNaOyNWlkL924tJ3jk44g9jqbY8hFpjkBerkfEkC+iQ3RKC8ovpeKo6KK/vWayy3zTXG3w=
script:
  # Build latest
  - docker build -f $DOCKER_FILE -t $DOCKER_REPO_SLUG:latest .
  # Build tag
  - if [[ $TRAVIS_TAG = $TRAVIS_BRANCH ]]; then docker build -f $DOCKER_FILE -t $DOCKER_REPO_SLUG:$TRAVIS_BRANCH .; else true ; fi
after_success:
  # Login
  - docker login -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD";
  # push to latest if master branch
  - if [[ $TRAVIS_BRANCH = master ]]; then docker push $DOCKER_REPO_SLUG:latest; else true; fi
  # push tag as well
  - if [[ $TRAVIS_TAG = $TRAVIS_BRANCH ]]; then docker push $DOCKER_REPO_SLUG:$TRAVIS_TAG; else true ; fi
